# fn-10-p87.7 Sync user split tables (credentials, subscriptions, settings, roles)

## Description

Sync the V1 user JSONB data into the V2 user split tables: user_credentials, user_subscriptions, user_settings, user_roles. The main user table is already synced.

**Size:** M
**Files:**

- Xano endpoint 18027 (via MCP)

## Approach

Use the documented field mappings from V1_V2_TABLE_MAPPING.md (lines 35-56):

### user_credentials (mvpw5_665)

```sql
INSERT INTO mvpw5_665 (user_id, password_hash, api_key, oauth_google)
SELECT
  v1.id,
  v1.xdo->>'password',
  v1.xdo->>'api_key',
  v1.xdo->>'google_sub'
FROM mvpw1_41 v1
WHERE v1.id NOT IN (SELECT user_id FROM mvpw5_665)
ON CONFLICT (user_id) DO NOTHING;
```

### user_subscriptions (mvpw5_666)

```sql
INSERT INTO mvpw5_666 (user_id, stripe_customer_id, plan_type)
SELECT
  v1.id,
  v1.xdo->>'stripe_customer_id',
  v1.xdo->>'subscription_type'
FROM mvpw1_41 v1
WHERE v1.id NOT IN (SELECT user_id FROM mvpw5_666)
ON CONFLICT (user_id) DO NOTHING;
```

### user_settings (mvpw5_667)

```sql
INSERT INTO mvpw5_667 (user_id, privacy_mode, daily_email_enabled)
SELECT
  v1.id,
  (v1.xdo->>'privacy_mode')::boolean,
  (v1.xdo->>'daily_dash_daily')::boolean
FROM mvpw1_41 v1
WHERE v1.id NOT IN (SELECT user_id FROM mvpw5_667)
ON CONFLICT (user_id) DO NOTHING;
```

### user_roles (mvpw5_668)

```sql
INSERT INTO mvpw5_668 (user_id, is_team_owner, is_leader, is_director, is_mentor)
SELECT
  v1.id,
  (v1.xdo->>'is_team_owner')::boolean,
  (v1.xdo->>'is_leader')::boolean,
  (v1.xdo->>'is_director')::boolean,
  (v1.xdo->>'is_mentor')::boolean
FROM mvpw1_41 v1
WHERE v1.id NOT IN (SELECT user_id FROM mvpw5_668)
ON CONFLICT (user_id) DO NOTHING;
```

## Key context

- V1 user table: mvpw1_41
- Mappings already documented in V1_V2_TABLE_MAPPING.md
- user_preferences (711) and user_onboarding (929) may have no V1 source data

## Acceptance

- [x] user_credentials populated from V1 (password, api_key, confirmed, etc.)
- [x] user_subscriptions populated from V1 (subscription_type, paid, stripe IDs)
- [x] user_settings populated from V1 (view, daily dash prefs, network news)
- [x] user_roles populated from V1 (is_team_owner, is_leader, is_director, is_mentor, etc.)
- [x] Record counts match user main table (335 records each)
- [x] No orphan references (all user_ids exist in user table)
- [x] curl test confirms sync: 335 records in all 4 tables

## Done summary

- Task completed

## Evidence

- Commits:
- Tests:
- PRs:
