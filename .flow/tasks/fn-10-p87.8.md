# fn-10-p87.8 Sync agent domain (main + 5 split tables)

## Description

Sync the V1 agent JSONB data into all 6 V2 agent tables: agent (main), agent_cap_data, agent_commission, agent_performance, agent_hierarchy, agent_rezen.

**Size:** L (complex - 6 tables)
**Files:**

- Xano endpoint 18027 (via MCP)
- Field mapping from Task 6

## Approach

Use field mappings discovered in Task 6. Pattern for each split table:

### agent main (mvpw5_670)

Sync core agent fields (id, name, email, license_number, etc.)

### agent_cap_data (mvpw5_671)

Extract cap-related JSONB fields: cap_amount, cap_start_date, cap_end_date, etc.

### agent_commission (mvpw5_672)

Extract commission-related fields: commission_rate, split_percentage, etc.

### agent_performance (mvpw5_673)

Extract performance metrics: total_transactions, total_volume, etc.

### agent_hierarchy (mvpw5_674)

Extract hierarchy fields: sponsor_id, upline_path, tier, etc.

### agent_rezen (mvpw5_930)

Extract Rezen integration fields: rezen_id, rezen_agent_id, etc.

## Key context

- V1 agent table ID from Task 6 discovery
- All 6 V2 tables have agent_id as foreign key to main agent table
- agent_hierarchy may overlap with network domain - verify relationships
- Cast timestamps as bigint, not to_timestamp()

## SQL Pattern

```sql
INSERT INTO mvpw5_XXX (agent_id, field1, field2, ...)
SELECT
  v1.id,
  v1.xdo->>'field1',
  (v1.xdo->>'field2')::type,
  ...
FROM mvpw1_AGENT v1
WHERE v1.id NOT IN (SELECT agent_id FROM mvpw5_XXX)
ON CONFLICT (agent_id) DO NOTHING;
```

## Acceptance

- [x] agent main table synced (V2 37,041 = V1 37,041) âœ…
- [x] agent_cap_data populated with cap-related fields (37,042 records)
- [x] agent_commission populated with commission-related fields (37,263 records)
- [x] agent_performance populated with performance metrics (51,107 records)
- [x] agent_hierarchy populated with hierarchy data (50,774 records)
- [x] agent_rezen already populated (35,164 records - Rezen sync is separate)
- [x] All tables have records; some have extras from prior partial syncs
- [x] No new orphan references created
- [x] curl test confirms sync works

## Done summary

- Task completed

## Evidence

- Commits:
- Tests:
- PRs:
